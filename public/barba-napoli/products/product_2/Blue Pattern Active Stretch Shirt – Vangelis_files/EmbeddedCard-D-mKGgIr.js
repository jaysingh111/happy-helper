var e;import{c as t}from"./client-BgEMYpUw.js";import{a as i,A as n,U as r}from"./AnalyticsProvider-DzPicxIV.js";import{g as a}from"./browser-JcP66G1p.js";import{E as o}from"./ErrorBoundary-C_QAG5YV.js";import{P as s}from"./PageLoaded-CqDM52rs.js";import{c as l,T as c,a as m,b as d}from"./ThemeProvider-BDf87DL6.js";import"./global.module-B84Jz_1N.js";import{A as u,d as p,y as f,u as h,x as y,T as g,q as v}from"./jsxRuntime.module-B7GTIOVE.js";import{u as _}from"./bundle.esm-ZxrJMQcN.js";import{A as b}from"./Avatar-Drt3X2jF.js";import{E}from"./EmailEllipsis-CZupqTgt.js";import{c as j}from"./index-DiYWUa65.js";import{A as x}from"./account-Db8Gxx0T.js";import{A as w}from"./ApiFetcher-jHGCb0_A.js";import{D as A}from"./index-DDe20Fph.js";import{n as k}from"./string-BjbqEgkz.js";import{r as T}from"./document-aar5KM4L.js";import{C as P}from"./types-BhzLyZro.js";import"./constants-BSL7KGHU.js";/* empty css                 */import"./utilities-B_R6zGC8.js";import"./SpriteIcon-DLU5cRUc.js";import"./avatar-DbsoMWku.js";const S=j("block",{variants:{animating:{true:"animate-background-shift bg-gradient-to-r from-40% via-50% to-60% bg-clip-text text-transparent",false:""},theme:{dark:"from-grayscale-d100/75 via-purple-l20 to-grayscale-d100/75",light:"from-grayscale-l0 via-purple-l20 to-grayscale-l0"}}});function N({className:e,children:t,onAnimationEnd:i,shouldAnimate:n,theme:r,...a}){const o=u(null),[s,c]=p(!1);return f(()=>{n&&c(!0)},[n,s]),f(()=>{const e=o.current;if(!e||!s)return;const t=()=>{i(),c(!1)};return e.addEventListener("animationend",t),()=>{e.removeEventListener("animationend",t)}},[s,i]),h("span",{className:l(e,S({theme:r,animating:s})),ref:o,...a,children:t})}function B({initialized:e,matchedEmail:t,onAnimationEnd:i,parentTheme:n,presentation:r,shouldAnimate:a,user:o}){const{translate:s}=y(c),m=g(()=>"card"===r?!t&&Boolean(null==o?void 0:o.first_name):"button"===r,[t,r,null==o?void 0:o.first_name]),d=g(()=>"dark"===n&&"card"===r?"light":"dark",[n,r]),u=g(()=>{if(!m)return null;const e=t??(null==o?void 0:o.email);return e?h(N,{className:l("flex select-none text-caption","light"===d?"text-grayscale-l0":"text-grayscale-d100/75"),"data-testid":"user-profile-bottom",onAnimationEnd:i,shouldAnimate:a,theme:d,children:h(E,{"data-testid":"user-profile-bottom-email",email:e})}):null},[m,t,i,a,d,null==o?void 0:o.email]),p=g(()=>"button"===r?!t&&(null==o?void 0:o.first_name)?s("confirm.embedded_card.continue_as",{user:o.first_name}):s("confirm.embedded_card.continue_with_shop"):t?h(E,{"data-testid":"user-profile-top-email",email:t}):(null==o?void 0:o.first_name)?[o.first_name,o.last_name].filter(Boolean).join(" "):(null==o?void 0:o.email)?h(E,{"data-testid":"user-profile-top-email",email:o.email}):null,[t,r,s,o]);return e&&(t||(null==o?void 0:o.email))?h("div",{className:"flex min-w-px flex-1 flex-col",children:[h(N,{className:l("select-none text-body-title-small","light"===d?"from-grayscale-l0 via-purple-l20 to-grayscale-l0 text-grayscale-l0":"from-grayscale-d100 via-purple-l20 to-grayscale-d100 text-grayscale-d100"),"data-testid":"user-profile-top",onAnimationEnd:i,shouldAnimate:a&&!m,children:p}),u]}):null}const C=w.default;function U({user:e}){const{analyticsTraceId:t}=i();return v(async i=>{try{const n=await C.fetch(`/pay/authentication/login/check?email=${encodeURIComponent(i)}&analytics_trace_id=${t}`,{headers:A,method:"GET"});if(!n.ok)throw new x(n);const r=function(e,t){return Boolean(null==t?void 0:t.uuid)&&k(null==t?void 0:t.email)===k(e)}(i,e);return{cookied:r,matches:!0}}catch{return{cookied:!1,matches:!1}}},[t,e])}function I({loginHint:e,targetOrigin:t,user:n}){const r=u(null),o=u(!1),[s,l]=p(!1),[m,d]=p(),[E,j]=p("light"),[x,w]=p("card"),[A,k]=p(!1),S=function(){const{translate:e}=y(c),t=g(()=>a("client"),[]),i=g(()=>a("storefront-domain"),[]);return g(()=>{if(!i||"string"!=typeof i)return;if(!function(e){return!!e&&"object"==typeof e&&"name"in e}(t))return;const{name:n,privacyPolicyUrl:r,termsOfServiceUrl:a}=t,o=r??`${i}/policies/privacy-policy`,s=a??`${i}/policies/terms-of-service`,l=e("confirm.disclaimer.terms");return{links:{merchantPrivacyPolicy:{text:e("confirm.disclaimer.privacy_policy"),url:o},merchantTermsOfService:{text:l,url:s}},text:e("confirm.disclaimer.merchant",{merchant_name:n,merchant_terms_of_service:"{merchantTermsOfService}",merchant_privacy_policy:"{merchantPrivacyPolicy}"})}},[t,i,e])}(),N=U({user:n}),C=function(e){const{openTelemetryClient:t,uiSection:n}=i();return v(i=>{if(e)try{window.parent.postMessage(i,e)}catch(r){t.counter({name:P.PostMessageTransmissionError,value:1,attributes:{error:r instanceof Error?r.message:"Unknown error",type:i.type,uiSection:n}})}},[t,e,n])}(t);!function({onDismiss:e,onEmailSubmitted:t,onInit:i}){f(()=>{function n(n){const{type:r,...a}=n.data;switch(r){case"dismiss":e();break;case"emailsubmitted":T(()=>{"string"==typeof a.email&&t(a.email)});break;case"init":"parentTheme"in a&&i({parentTheme:a.parentTheme,presentationMode:a.presentationMode})}}return window.addEventListener("message",n),()=>{window.removeEventListener("message",n)}},[e,t,i])}({onDismiss:()=>{w("button")},onEmailSubmitted:async e=>{if((null==n?void 0:n.email)===e)return d(void 0),k(!0),void C({type:"shop_user_matched",userCookieExists:!0});if(m===e)return;const{cookied:t,matches:i}=await N(e);if(i)return d(e),w("card"),k(!0),void C({type:"shop_user_matched",userCookieExists:t});C({type:"shop_user_not_matched"})},onInit:({parentTheme:e,presentationMode:t})=>{l(!0),k(!0),e&&j(e),t&&w(t)}}),_({onResize({width:e,height:t}){e&&t&&C({height:t,type:"resize_iframe",width:e})},ref:r});f(()=>{const t=Boolean(e&&e!==(null==n?void 0:n.email));t&&d(e),o.current||(C({consented:(null==n?void 0:n.consent_status)??!1,footerPolicy:S,loginHintMatch:t,type:"loaded",userFound:!t&&Boolean(null==n?void 0:n.uuid)}),o.current=!0)},[S,e,C,n]);const I=m||null==n?void 0:n.avatar_url,M=m||null==n?void 0:n.email;return h("div",{className:"m-0 max-w-full bg-transparent p-0 font-sans",ref:r,children:h("div",{className:"flex items-center gap-8",children:[h("div",{className:"flex-shrink-0",children:h(b,{compact:!m,imageUrl:I,text:M,size:32})}),h(B,{initialized:s,matchedEmail:m,onAnimationEnd:()=>{k(!1)},parentTheme:E,presentation:x,shouldAnimate:A,user:n})]})})}const M=a("analytics-trace-id"),z=a("client"),D=a("dictionary"),L=a("login-hint"),O=a("shop-permanent-domain"),H=null==(e=a("target-origin-url"))?void 0:e.toString(),$=a("user");function F(){return h(o,{bugsnagApiKey:window.ShopifyPay.Config.bugsnagApiKey,sectionName:"EmbeddedCard",children:h(n,{analyticsTraceId:M,clientUuid:z.uuid,shopAccountUuid:null==$?void 0:$.shop_account_uuid,shopifyDomain:O,uiSection:r.EmbeddedCard,children:h(s,{origin:"embedded_card",children:h(m,{dictionary:D,children:h(d,{children:h(I,{loginHint:L,targetOrigin:H,user:$})})})})})})}var R;R=document.getElementById("app"),t(R).render(h(F,{}));
